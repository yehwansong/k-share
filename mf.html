<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="common.css">
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
  <script type="text/javascript" src="firebase-load.js"></script>
  <script type="text/javascript">
  // sun
  // input : d1, d2, a, b1, b2, c1, c2
  // output : none


  // input(2) -- d1,d2
  var canvas, ctx;
  var mouseX, mouseY, mouseDown = 0;
  var touchX, touchY;

  function drawDot(ctx, x, y, size) {
    r = 0;
    g = 0;
    b = 0;
    a = 255;
    ctx.fillStyle = "rgba(" + r + "," + g + "," + b + "," + (a / 255) + ")";
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2, true);
    ctx.closePath();
    ctx.fill();
  }

  function clearCanvas(canvas, ctx) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function onFirebaseReady() {
    console.log('onFirebaseReady handler');

    canvas = document.getElementById('sketchpad');

    if (canvas.getContext) {
      ctx = canvas.getContext('2d');
    }
  }  

  // input(1) -- b1,b2,c1,c2
  function firebaseValueChangeHandler(values) {
    console.log('firebaseValueChangeHandler')

    if (values.a) {
      $('body').css({ 'opacity': 0 })
    } else {
      $('body').css({ 'opacity': 1 })
    }

    var w = window.innerWidth
        $('.bg').css({ 'margin-left': -2*w + values.b1 % (w*2) + 'px' })
        console.log(values.b1)
      // if (values.b2 > values.c2) {
      //   $('.bg').css({ 'margin-left': -2*w + values.b1 % (w*2) + 'px' })
      // } else {
      // }

    drawDot(ctx, values.d1, values.d2, 12);
  }


  // FIXME sketchpad_touchStart not called in this script

  /*
  setInterval(function() {
    function sketchpad_touchStart() {
      getTouchPos();
      drawDot(ctx, d1, d2, 12);
      event.preventDefault();
    }
    function sketchpad_touchMove(e) {
      getTouchPos(e);

      drawDot(ctx, d1, d2, 12);

      event.preventDefault();
    }
  }, 100);
  */

  </script>
  <style>
    .bg{
        width: 400vw;
        height: 100vh;
        /*left: -100vw;*/
        position: absolute;
        background-image: url('img/sky.jpg');
        background-size: auto 100vh;
    }
</style>
</head>

<body>
  <div class="bg"></div>
  <div id="sketchpadapp">
    <div class="leftside">
      <input type="submit" value="Clear Sketchpad" id="clearbutton" onclick="clearCanvas(canvas,ctx);">
    </div>
    <div class="rightside">
      <canvas id="sketchpad" height="300" width="400">
      </canvas>
    </div>
  </div>
</body>